<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <title>Audio Hub Control</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b0f14; --panel:#0f172a; --panel-2:#111827; --line:#1f2937;
      --text:#e6edf3; --muted:#9ca3af; --brand:#2563eb; --warn:#7c2d12;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    header{display:flex;align-items:center;justify-content:space-between;
      gap:12px;padding:14px 16px;background:var(--panel-2);
      border-bottom:1px solid var(--line);position:sticky;top:0;z-index:30}
    header .brand{display:flex;gap:8px;align-items:center;font-weight:700}
    header .right{display:flex;gap:8px;align-items:center}
    main{display:grid;grid-template-columns:280px 1fr;gap:16px;padding:16px}
    .card{background:var(--panel);border:1px solid var(--line);
      border-radius:16px;padding:16px;box-shadow:0 10px 20px rgb(0 0 0 / .2)}
    .muted{color:var(--muted)}

    button,input,select,textarea{background:var(--panel-2);color:var(--text);
      border:1px solid var(--line);border-radius:10px;padding:8px 12px}
    button{cursor:pointer;transition:.15s transform,.15s opacity;
      display:inline-flex;align-items:center;gap:8px}
    button:hover{transform:translateY(-1px);opacity:.95}
    button:active{transform:translateY(0);opacity:.9}
    .primary{background:var(--brand);border-color:var(--brand)}
    .warn{background:var(--warn);border-color:var(--warn)}
    .ghost{background:transparent}
    .pill{border-radius:999px;padding:6px 10px}
    .ok{color:#22c55e}.err{color:#ef4444}

    /* Sidebar playlists */
    .sidebar h3{margin:0 0 8px}
    .pl-list{display:flex;flex-direction:column;gap:8px;max-height:60vh;overflow:auto}
    .pl-item{display:flex;align-items:center;justify-content:space-between;
      gap:8px;padding:10px;border:1px solid var(--line);border-radius:10px}
    .pl-item .name{font-weight:600}
    .pl-item small{color:var(--muted)}

    /* Player stile Spotify */
    .player{display:grid;grid-template-columns:100px 1fr;gap:16px;align-items:center}
    .cover{width:100px;height:100px;border-radius:10px;background:#0b1220;
      border:1px solid var(--line);display:flex;align-items:center;
      justify-content:center;font-weight:700;color:#94a3b8}
    .track-meta{display:flex;flex-direction:column;gap:4px}
    .track-title{font-weight:700}
    .controls{display:flex;align-items:center;gap:8px;margin-top:8px;flex-wrap:wrap}
    .range{appearance:none;width:100%;height:6px;background:#0f1a2e;
      border-radius:999px;outline:none}
    .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border-bottom:1px solid var(--line);padding:8px;text-align:left}
    .table th{color:var(--muted);font-weight:600}

    /* Modals */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);
      display:none;align-items:center;justify-content:center;z-index:50}
    .modal{width:min(780px,92vw);max-height:86vh;overflow:auto;
      background:var(--panel);border:1px solid var(--line);border-radius:16px;
      padding:16px;box-shadow:0 20px 40px rgba(0,0,0,.45)}
    .modal.show{display:flex}
    .modal .header{display:flex;justify-content:space-between;
      align-items:center;margin-bottom:10px}
    .two-cols{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .listbox{border:1px solid var(--line);border-radius:10px;padding:8px;
      height:320px;overflow:auto;background:var(--panel-2)}

    /* Blocca UI se non autenticato */
    body.locked main,
    body.locked header .right > *:not(#btnLogin){
      pointer-events:none;filter:grayscale(1) opacity(0.6);
    }

    /* Toggle */
    .toggle{border-radius:999px;padding:6px 12px;background:transparent;
      border:1px solid var(--line);color:var(--text);cursor:pointer;}
    .toggle.on{background:var(--brand);border-color:var(--brand);}

    /* Barra quota */
    .quota{display:flex;align-items:center;gap:10px;margin-top:6px;}
    .bar{flex:1;height:8px;background:#0f1a2e;border-radius:999px;
      overflow:hidden;border:1px solid #1f2a40;}
    .bar>span{display:block;height:100%;background:var(--brand);width:0%;}

    /* ========== ðŸ“± MOBILE MODE ========== */
    #btnMenu{display:none;}

    @media (max-width:768px){

      body{overflow-x:hidden;}
      main{display:block;padding:12px;}
      .card{padding:12px;}

      /* Player compatto */
      .player{grid-template-columns:72px 1fr;gap:12px;}
      .cover{width:72px;height:72px;}

      /* Sidebar a scomparsa */
      .sidebar{
        position:fixed;top:56px;left:0;width:80%;max-width:300px;
        height:calc(100vh - 56px);background:var(--panel-2);
        border-right:1px solid var(--line);border-radius:0;
        box-shadow:8px 0 20px rgba(0,0,0,.4);
        transform:translateX(-100%);
        transition:transform .3s ease;
        z-index:20;overflow-y:auto;
      }
      body.sidebar-open .sidebar{transform:translateX(0);}

      /* Overlay dietro */
      #sidebarOverlay{
        position:fixed;inset:0;background:rgba(0,0,0,0.5);
        z-index:10;display:none;
      }
      body.sidebar-open #sidebarOverlay{display:block;}

      /* Header adattato */
      header{flex-wrap:wrap;gap:6px;}
      header .brand{font-size:0.95rem;}
      header .right{width:100%;justify-content:space-between;}

      /* Menu visibile */
      #btnMenu{display:inline-flex;}
    }
  </style>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>

  <header>
    <div class="brand">
      <button id="btnMenu" class="pill ghost"><i data-lucide="menu"></i></button>
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
        <path d="M5 3v18l7-5 7 5V3"
              stroke="#60a5fa" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Audio Hub
      <span class="muted">Â· control</span>
    </div>
    <div class="right">
      <span id="topStatus" class="muted">â€”</span>
      <button id="btnLogin" class="pill ghost"><i data-lucide="log-in"></i> Login</button>
    </div>
  </header>

  <!-- Overlay per mobile -->
  <div id="sidebarOverlay"></div>

  <main>
    <!-- Sidebar playlists -->
    <aside class="card sidebar">
      <div class="row" style="justify-content:space-between">
        <h3>Playlist</h3>
        <button id="btnNewPl" class="pill primary"><i data-lucide="plus"></i> Crea</button>
      </div>
      <div id="plSidebar" class="pl-list"></div>
    </aside>

    <!-- Colonna destra: Player + Files + Schedule -->
    <section class="card">
      <!-- Player -->
      <div class="player">
        <div class="cover" id="cover">â™«</div>
        <div>
          <div class="track-meta">
            <div id="trkTitle" class="track-title">â€”</div>
            <div class="muted" id="trkState">stato: â€”</div>
            <div class="muted" id="nowPl">playlist: â€”</div>
          </div>

          <div style="margin:10px 0">
            <div class="row" style="justify-content:space-between">
              <small class="muted" id="timeCur">0:00</small>
              <small class="muted" id="timeTot">0:00</small>
            </div>
            <input id="seekBar" type="range" min="0" max="0" value="0" class="range">
          </div>

          <div class="controls">
            <button id="btnPrev" class="pill"><i data-lucide="skip-back"></i></button>
            <button id="btnPlay" class="pill primary"><i data-lucide="play"></i></button>
            <button id="btnPause" class="pill" style="display:none"><i data-lucide="pause"></i></button>
            <button id="btnStop" class="pill"><i data-lucide="square"></i></button>
            <button id="btnNext" class="pill"><i data-lucide="skip-forward"></i></button>
            <button id="btnLoop" class="pill" title="Ripeti brano"><i data-lucide="repeat"></i></button>

            <div class="row" style="margin-left:8px">
              <small class="muted">Vol</small>
              <input id="volAbs" type="number" min="0" max="200" value="75" style="width:76px">
              <button id="btnVolAbs" class="pill">Set</button>
              <button id="btnVolDown" class="pill">-10</button>
              <button id="btnVolUp" class="pill">+10</button>
              <button id="btnClear" class="pill warn">Clear</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Files -->
      <div class="row" style="margin-top:18px;justify-content:space-between">
        <h3 style="margin:0">Files (R2)</h3>
        <div class="row">
          <input id="r2Prefix" placeholder="prefisso es: test/" />
          <button id="r2List" class="pill"><i data-lucide="refresh-ccw"></i> Lista</button>
          <span id="r2Count" class="muted"></span>
        </div>
      </div>

      <!-- Quota -->
      <div class="quota">
        <div class="bar"><span id="quotaBar"></span></div>
        <small id="quotaText" class="muted">0 / 20000 MB</small>
      </div>

      <!-- Upload -->
      <div class="row" style="margin-top:10px">
        <input type="file" id="filesUpload" />
        <button id="filesUploadBtn" class="pill primary"><i data-lucide="upload"></i> Aggiungi file</button>
      </div>

      <table class="table" id="r2Table" style="margin-top:8px"></table>

      <!-- Schedule -->
      <div class="row" style="margin-top:24px;justify-content:space-between">
        <h3 style="margin:0">Schedule</h3>
        <div class="row">
          <button id="btnNewSched" class="pill primary"><i data-lucide="plus-circle"></i> Crea</button>
          <button id="schReload" class="pill"><i data-lucide="refresh-ccw"></i> Aggiorna</button>
          <span id="schCount" class="muted"></span>
        </div>
      </div>
      <table class="table" id="schTable" style="margin-top:8px"></table>
    </section>
  </main>

  <!-- Modali (login, playlist, schedule) -->
  <div id="loginWrap" class="modal-backdrop"></div>
  <div id="plWrap" class="modal-backdrop"></div>
  <div id="schWrap" class="modal-backdrop"></div>

  <script src="app.js"></script>
  <script>
    lucide.createIcons();
    const btnMenu=document.getElementById('btnMenu');
    const overlay=document.getElementById('sidebarOverlay');
    btnMenu?.addEventListener('click',()=>document.body.classList.toggle('sidebar-open'));
    overlay?.addEventListener('click',()=>document.body.classList.remove('sidebar-open'));
  </script>
</body>
</html>
